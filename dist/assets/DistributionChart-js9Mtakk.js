import{a as ie,C as Mt,b as Et}from"./ContextMenu-ziKpGTJN.js";import{h as I,a4 as ct,ar as Nt,as as oe,Q as se,$ as Yt,at as jt,F as ue,V as le,au as Y,m as j,g as yt,a5 as de,j as kt,i as mt,a6 as ht,av as gt,aw as ce,ax as ft,a0 as _t,ay as Xt,Y as Q,az as Ct,aA as he,aB as ge,aC as fe,l as ve,aD as pe,aE as Tt,_ as Vt,v as At,aF as Gt,a7 as zt,aG as ye,aH as $t,aI as Bt,R as Kt,aJ as me,aK as xe,aL as Ie,aM as Le,aN as Ve,aO as we,P as Se,y as Pt,aP as De,a1 as be,K as Me,aQ as Ee,S as ke,al as _e,an as Ce}from"./YearToggle-Boe53fpQ.js";import{V as Te,W as Ae,r as Ge}from"./Button-BP00bKSb.js";import{d as Wt,e as Ut,C as ze,c as C,f as $e,o as tt,h as q,a as xt,m as Be,n as O,x as Rt,b as P,g as Pe,_ as qt,A as Re,i as Fe,ah as Ft,s as R,j as He,$ as F}from"./index-h_7xmTiz.js";import{C as Oe}from"./Dashboard-B4_Lh2lJ.js";import"./ComponentTransition-AFw05anb.js";var w=oe();function Ne(a){var t=a.mainData,e=a.datas;e||(e={main:t},a.datasAttr={main:"data"}),a.datas=a.mainData=null,Zt(t,e,a),I(e,function(n){I(t.TRANSFERABLE_METHODS,function(r){n.wrapMethod(r,ct(Ye,a))})}),t.wrapMethod("cloneShallow",ct(Xe,a)),I(t.CHANGABLE_METHODS,function(n){t.wrapMethod(n,ct(je,a))}),Nt(e[t.dataType]===t)}function Ye(a,t){if(Ue(this)){var e=se({},w(this).datas);e[this.dataType]=t,Zt(t,e,a)}else wt(t,this.dataType,w(this).mainData,a);return t}function je(a,t){return a.struct&&a.struct.update(),t}function Xe(a,t){return I(w(t).datas,function(e,n){e!==t&&wt(e.cloneShallow(),n,t,a)}),t}function Ke(a){var t=w(this).mainData;return a==null||t==null?t:w(t).datas[a]}function We(){var a=w(this).mainData;return a==null?[{data:a}]:Yt(jt(w(a).datas),function(t){return{type:t,data:w(a).datas[t]}})}function Ue(a){return w(a).mainData===a}function Zt(a,t,e){w(a).datas={},I(t,function(n,r){wt(n,r,a,e)})}function wt(a,t,e,n){w(e).datas[t]=a,w(a).mainData=e,a.dataType=t,n.struct&&(a[n.structAttr]=n.struct,n.struct[n.datasAttr[t]]=a),a.getLinkedData=Ke,a.getLinkedDataAll=We}var X=I,qe=j,et=-1,St=function(){function a(t){var e=t.mappingMethod,n=t.type,r=this.option=ue(t);this.type=n,this.mappingMethod=e,this._normalizeData=Qe[e];var i=a.visualHandlers[n];this.applyVisual=i.applyVisual,this.getColorMapper=i.getColorMapper,this._normalizedToVisual=i._normalizedToVisual[e],e==="piecewise"?(vt(r),Ze(r)):e==="category"?r.categories?Je(r):vt(r,!0):(Nt(e!=="linear"||r.dataExtent),vt(r))}return a.prototype.mapValueToVisual=function(t){var e=this._normalizeData(t);return this._normalizedToVisual(e,t)},a.prototype.getNormalizer=function(){return kt(this._normalizeData,this)},a.listVisualTypes=function(){return jt(a.visualHandlers)},a.isValidType=function(t){return a.visualHandlers.hasOwnProperty(t)},a.eachVisual=function(t,e,n){j(t)?I(t,e,n):e.call(n,t)},a.mapVisual=function(t,e,n){var r,i=yt(t)?[]:j(t)?{}:(r=!0,null);return a.eachVisual(t,function(o,s){var u=e.call(n,o,s);r?i=u:i[s]=u}),i},a.retrieveVisuals=function(t){var e={},n;return t&&X(a.visualHandlers,function(r,i){t.hasOwnProperty(i)&&(e[i]=t[i],n=!0)}),n?e:null},a.prepareVisualTypes=function(t){if(yt(t))t=t.slice();else if(qe(t)){var e=[];X(t,function(n,r){e.push(r)}),t=e}else return[];return t.sort(function(n,r){return r==="color"&&n!=="color"&&n.indexOf("color")===0?1:-1}),t},a.dependsOn=function(t,e){return e==="color"?!!(t&&t.indexOf(e)===0):t===e},a.findPieceIndex=function(t,e,n){for(var r,i=1/0,o=0,s=e.length;o<s;o++){var u=e[o].value;if(u!=null){if(u===t||mt(u)&&u===t+"")return o;n&&f(u,o)}}for(var o=0,s=e.length;o<s;o++){var l=e[o],d=l.interval,g=l.close;if(d){if(d[0]===-1/0){if(J(g[1],t,d[1]))return o}else if(d[1]===1/0){if(J(g[0],d[0],t))return o}else if(J(g[0],d[0],t)&&J(g[1],t,d[1]))return o;n&&f(d[0],o),n&&f(d[1],o)}}if(n)return t===1/0?e.length-1:t===-1/0?0:r;function f(v,c){var h=Math.abs(v-t);h<i&&(i=h,r=c)}},a.visualHandlers={color:{applyVisual:H("color"),getColorMapper:function(){var t=this.option;return kt(t.mappingMethod==="category"?function(e,n){return!n&&(e=this._normalizeData(e)),N.call(this,e)}:function(e,n,r){var i=!!r;return!n&&(e=this._normalizeData(e)),r=gt(e,t.parsedVisual,r),i?r:ht(r,"rgba")},this)},_normalizedToVisual:{linear:function(t){return ht(gt(t,this.option.parsedVisual),"rgba")},category:N,piecewise:function(t,e){var n=Lt.call(this,e);return n==null&&(n=ht(gt(t,this.option.parsedVisual),"rgba")),n},fixed:k}},colorHue:Z(function(t,e){return ft(t,e)}),colorSaturation:Z(function(t,e){return ft(t,null,e)}),colorLightness:Z(function(t,e){return ft(t,null,null,e)}),colorAlpha:Z(function(t,e){return ce(t,e)}),decal:{applyVisual:H("decal"),_normalizedToVisual:{linear:null,category:N,piecewise:null,fixed:null}},opacity:{applyVisual:H("opacity"),_normalizedToVisual:It([0,1])},liftZ:{applyVisual:H("liftZ"),_normalizedToVisual:{linear:k,category:k,piecewise:k,fixed:k}},symbol:{applyVisual:function(t,e,n){var r=this.mapValueToVisual(t);n("symbol",r)},_normalizedToVisual:{linear:Ht,category:N,piecewise:function(t,e){var n=Lt.call(this,e);return n==null&&(n=Ht.call(this,t)),n},fixed:k}},symbolSize:{applyVisual:H("symbolSize"),_normalizedToVisual:It([0,1])}},a}();function Ze(a){var t=a.pieceList;a.hasSpecialVisual=!1,I(t,function(e,n){e.originIndex=n,e.visual!=null&&(a.hasSpecialVisual=!0)})}function Je(a){var t=a.categories,e=a.categoryMap={},n=a.visual;if(X(t,function(o,s){e[o]=s}),!yt(n)){var r=[];j(n)?X(n,function(o,s){var u=e[s];r[u??et]=o}):r[et]=n,n=Jt(a,r)}for(var i=t.length-1;i>=0;i--)n[i]==null&&(delete e[t[i]],t.pop())}function vt(a,t){var e=a.visual,n=[];j(e)?X(e,function(i){n.push(i)}):e!=null&&n.push(e);var r={color:1,symbol:1};!t&&n.length===1&&!r.hasOwnProperty(a.type)&&(n[1]=n[0]),Jt(a,n)}function Z(a){return{applyVisual:function(t,e,n){var r=this.mapValueToVisual(t);n("color",a(e("color"),r))},_normalizedToVisual:It([0,1])}}function Ht(a){var t=this.option.visual;return t[Math.round(Y(a,[0,1],[0,t.length-1],!0))]||{}}function H(a){return function(t,e,n){n(a,this.mapValueToVisual(t))}}function N(a){var t=this.option.visual;return t[this.option.loop&&a!==et?a%t.length:a]}function k(){return this.option.visual[0]}function It(a){return{linear:function(t){return Y(t,a,this.option.visual,!0)},category:N,piecewise:function(t,e){var n=Lt.call(this,e);return n==null&&(n=Y(t,a,this.option.visual,!0)),n},fixed:k}}function Lt(a){var t=this.option,e=t.pieceList;if(t.hasSpecialVisual){var n=St.findPieceIndex(a,e),r=e[n];if(r&&r.visual)return r.visual[this.type]}}function Jt(a,t){return a.visual=t,a.type==="color"&&(a.parsedVisual=Yt(t,function(e){var n=de(e);return n||[0,0,0,1]})),t}var Qe={linear:function(a){return Y(a,this.option.dataExtent,[0,1],!0)},piecewise:function(a){var t=this.option.pieceList,e=St.findPieceIndex(a,t,!0);if(e!=null)return Y(e,[0,t.length-1],[0,1],!0)},category:function(a){var t=this.option.categories?this.option.categoryMap[a]:a;return t??et},fixed:le};function J(a,t,e){return a?t<=e:t<e}function $(a){return"_EC_"+a}var ta=function(){function a(t){this.type="graph",this.nodes=[],this.edges=[],this._nodesMap={},this._edgesMap={},this._directed=t||!1}return a.prototype.isDirected=function(){return this._directed},a.prototype.addNode=function(t,e){t=t==null?""+e:""+t;var n=this._nodesMap;if(!n[$(t)]){var r=new _(t,e);return r.hostGraph=this,this.nodes.push(r),n[$(t)]=r,r}},a.prototype.getNodeByIndex=function(t){var e=this.data.getRawIndex(t);return this.nodes[e]},a.prototype.getNodeById=function(t){return this._nodesMap[$(t)]},a.prototype.addEdge=function(t,e,n){var r=this._nodesMap,i=this._edgesMap;if(_t(t)&&(t=this.nodes[t]),_t(e)&&(e=this.nodes[e]),t instanceof _||(t=r[$(t)]),e instanceof _||(e=r[$(e)]),!(!t||!e)){var o=t.id+"-"+e.id,s=new Qt(t,e,n);return s.hostGraph=this,this._directed&&(t.outEdges.push(s),e.inEdges.push(s)),t.edges.push(s),t!==e&&e.edges.push(s),this.edges.push(s),i[o]=s,s}},a.prototype.getEdgeByIndex=function(t){var e=this.edgeData.getRawIndex(t);return this.edges[e]},a.prototype.getEdge=function(t,e){t instanceof _&&(t=t.id),e instanceof _&&(e=e.id);var n=this._edgesMap;return this._directed?n[t+"-"+e]:n[t+"-"+e]||n[e+"-"+t]},a.prototype.eachNode=function(t,e){for(var n=this.nodes,r=n.length,i=0;i<r;i++)n[i].dataIndex>=0&&t.call(e,n[i],i)},a.prototype.eachEdge=function(t,e){for(var n=this.edges,r=n.length,i=0;i<r;i++)n[i].dataIndex>=0&&n[i].node1.dataIndex>=0&&n[i].node2.dataIndex>=0&&t.call(e,n[i],i)},a.prototype.breadthFirstTraverse=function(t,e,n,r){if(e instanceof _||(e=this._nodesMap[$(e)]),!!e){for(var i=n==="out"?"outEdges":n==="in"?"inEdges":"edges",o=0;o<this.nodes.length;o++)this.nodes[o].__visited=!1;if(!t.call(r,e,null))for(var s=[e];s.length;)for(var u=s.shift(),l=u[i],o=0;o<l.length;o++){var d=l[o],g=d.node1===u?d.node2:d.node1;if(!g.__visited){if(t.call(r,g,u))return;s.push(g),g.__visited=!0}}}},a.prototype.update=function(){for(var t=this.data,e=this.edgeData,n=this.nodes,r=this.edges,i=0,o=n.length;i<o;i++)n[i].dataIndex=-1;for(var i=0,o=t.count();i<o;i++)n[t.getRawIndex(i)].dataIndex=i;e.filterSelf(function(s){var u=r[e.getRawIndex(s)];return u.node1.dataIndex>=0&&u.node2.dataIndex>=0});for(var i=0,o=r.length;i<o;i++)r[i].dataIndex=-1;for(var i=0,o=e.count();i<o;i++)r[e.getRawIndex(i)].dataIndex=i},a.prototype.clone=function(){for(var t=new a(this._directed),e=this.nodes,n=this.edges,r=0;r<e.length;r++)t.addNode(e[r].id,e[r].dataIndex);for(var r=0;r<n.length;r++){var i=n[r];t.addEdge(i.node1.id,i.node2.id,i.dataIndex)}return t},a}(),_=function(){function a(t,e){this.inEdges=[],this.outEdges=[],this.edges=[],this.dataIndex=-1,this.id=t??"",this.dataIndex=e??-1}return a.prototype.degree=function(){return this.edges.length},a.prototype.inDegree=function(){return this.inEdges.length},a.prototype.outDegree=function(){return this.outEdges.length},a.prototype.getModel=function(t){if(!(this.dataIndex<0)){var e=this.hostGraph,n=e.data.getItemModel(this.dataIndex);return n.getModel(t)}},a.prototype.getAdjacentDataIndices=function(){for(var t={edge:[],node:[]},e=0;e<this.edges.length;e++){var n=this.edges[e];n.dataIndex<0||(t.edge.push(n.dataIndex),t.node.push(n.node1.dataIndex,n.node2.dataIndex))}return t},a.prototype.getTrajectoryDataIndices=function(){for(var t=Q(),e=Q(),n=0;n<this.edges.length;n++){var r=this.edges[n];if(!(r.dataIndex<0)){t.set(r.dataIndex,!0);for(var i=[r.node1],o=[r.node2],s=0;s<i.length;){var u=i[s];s++,e.set(u.dataIndex,!0);for(var l=0;l<u.inEdges.length;l++)t.set(u.inEdges[l].dataIndex,!0),i.push(u.inEdges[l].node1)}for(s=0;s<o.length;){var d=o[s];s++,e.set(d.dataIndex,!0);for(var l=0;l<d.outEdges.length;l++)t.set(d.outEdges[l].dataIndex,!0),o.push(d.outEdges[l].node2)}}}return{edge:t.keys(),node:e.keys()}},a}(),Qt=function(){function a(t,e,n){this.dataIndex=-1,this.node1=t,this.node2=e,this.dataIndex=n??-1}return a.prototype.getModel=function(t){if(!(this.dataIndex<0)){var e=this.hostGraph,n=e.edgeData.getItemModel(this.dataIndex);return n.getModel(t)}},a.prototype.getAdjacentDataIndices=function(){return{edge:[this.dataIndex],node:[this.node1.dataIndex,this.node2.dataIndex]}},a.prototype.getTrajectoryDataIndices=function(){var t=Q(),e=Q();t.set(this.dataIndex,!0);for(var n=[this.node1],r=[this.node2],i=0;i<n.length;){var o=n[i];i++,e.set(o.dataIndex,!0);for(var s=0;s<o.inEdges.length;s++)t.set(o.inEdges[s].dataIndex,!0),n.push(o.inEdges[s].node1)}for(i=0;i<r.length;){var u=r[i];i++,e.set(u.dataIndex,!0);for(var s=0;s<u.outEdges.length;s++)t.set(u.outEdges[s].dataIndex,!0),r.push(u.outEdges[s].node2)}return{edge:t.keys(),node:e.keys()}},a}();function te(a,t){return{getValue:function(e){var n=this[a][t];return n.getStore().get(n.getDimensionIndex(e||"value"),this.dataIndex)},setVisual:function(e,n){this.dataIndex>=0&&this[a][t].setItemVisual(this.dataIndex,e,n)},getVisual:function(e){return this[a][t].getItemVisual(this.dataIndex,e)},setLayout:function(e,n){this.dataIndex>=0&&this[a][t].setItemLayout(this.dataIndex,e,n)},getLayout:function(){return this[a][t].getItemLayout(this.dataIndex)},getGraphicEl:function(){return this[a][t].getItemGraphicEl(this.dataIndex)},getRawIndex:function(){return this[a][t].getRawIndex(this.dataIndex)}}}Xt(_,te("hostGraph","data"));Xt(Qt,te("hostGraph","edgeData"));function ea(a,t,e,n,r){for(var i=new ta(n),o=0;o<a.length;o++)i.addNode(Ct(a[o].id,a[o].name,o),o);for(var s=[],u=[],l=0,o=0;o<t.length;o++){var d=t[o],g=d.source,f=d.target;i.addEdge(g,f,l)&&(u.push(d),s.push(Ct(he(d.id,null),g+" > "+f)),l++)}var v=e.get("coordinateSystem"),c;if(v==="cartesian2d"||v==="polar")c=ge(a,e);else{var h=fe.get(v),m=h?h.dimensions||[]:[];ve(m,"value")<0&&m.concat(["value"]);var p=pe(a,{coordDimensions:m,encodeDefine:e.getEncode()}).dimensions;c=new Tt(p,e),c.initData(a)}var y=new Tt(["value"],e);return y.initData(u,s),r&&r(c,y),Ne({mainData:c,struct:i,structAttr:"graph",datas:{node:c,edge:y},datasAttr:{node:"data",edge:"edgeData"}}),i.update(),i}var aa=function(){function a(){this.x1=0,this.y1=0,this.x2=0,this.y2=0,this.cpx1=0,this.cpy1=0,this.cpx2=0,this.cpy2=0,this.extent=0}return a}(),na=function(a){Vt(t,a);function t(e){return a.call(this,e)||this}return t.prototype.getDefaultShape=function(){return new aa},t.prototype.buildPath=function(e,n){var r=n.extent;e.moveTo(n.x1,n.y1),e.bezierCurveTo(n.cpx1,n.cpy1,n.cpx2,n.cpy2,n.x2,n.y2),n.orient==="vertical"?(e.lineTo(n.x2+r,n.y2),e.bezierCurveTo(n.cpx2+r,n.cpy2,n.cpx1+r,n.cpy1,n.x1+r,n.y1)):(e.lineTo(n.x2,n.y2+r),e.bezierCurveTo(n.cpx2,n.cpy2+r,n.cpx1,n.cpy1+r,n.x1,n.y1+r)),e.closePath()},t.prototype.highlight=function(){xe(this)},t.prototype.downplay=function(){Ie(this)},t}(Le),ra=function(a){Vt(t,a);function t(){var e=a!==null&&a.apply(this,arguments)||this;return e.type=t.type,e._focusAdjacencyDisabled=!1,e}return t.prototype.render=function(e,n,r){var i=this,o=e.getGraph(),s=this.group,u=e.layoutInfo,l=u.width,d=u.height,g=e.getData(),f=e.getData("edge"),v=e.get("orient");this._model=e,s.removeAll(),s.x=u.x,s.y=u.y,o.eachEdge(function(c){var h=new na,m=At(h);m.dataIndex=c.dataIndex,m.seriesIndex=e.seriesIndex,m.dataType="edge";var p=c.getModel(),y=p.getModel("lineStyle"),x=y.get("curveness"),V=c.node1.getLayout(),L=c.node1.getModel(),S=L.get("localX"),D=L.get("localY"),b=c.node2.getLayout(),Dt=c.node2.getModel(),K=Dt.get("localX"),W=Dt.get("localY"),B=c.getLayout(),T,A,G,z,nt,rt,it,ot;h.shape.extent=Math.max(1,B.dy),h.shape.orient=v,v==="vertical"?(T=(S!=null?S*l:V.x)+B.sy,A=(D!=null?D*d:V.y)+V.dy,G=(K!=null?K*l:b.x)+B.ty,z=W!=null?W*d:b.y,nt=T,rt=A*(1-x)+z*x,it=G,ot=A*x+z*(1-x)):(T=(S!=null?S*l:V.x)+V.dx,A=(D!=null?D*d:V.y)+B.sy,G=K!=null?K*l:b.x,z=(W!=null?W*d:b.y)+B.ty,nt=T*(1-x)+G*x,rt=A,it=T*x+G*(1-x),ot=z),h.setShape({x1:T,y1:A,x2:G,y2:z,cpx1:nt,cpy1:rt,cpx2:it,cpy2:ot}),h.useStyle(y.getItemStyle()),Ot(h.style,v,c);var bt=""+p.get("value"),st=Gt(p,"edgeLabel");zt(h,st,{labelFetcher:{getFormattedLabel:function(dt,U,Fa,ae,ne,re){return e.getFormattedLabel(dt,U,"edge",ae,ye(ne,st.normal&&st.normal.get("formatter"),bt),re)}},labelDataIndex:c.dataIndex,defaultText:bt}),h.setTextConfig({position:"inside"});var ut=p.getModel("emphasis");$t(h,p,"lineStyle",function(dt){var U=dt.getItemStyle();return Ot(U,v,c),U}),s.add(h),f.setItemGraphicEl(c.dataIndex,h);var lt=ut.get("focus");Bt(h,lt==="adjacency"?c.getAdjacentDataIndices():lt==="trajectory"?c.getTrajectoryDataIndices():lt,ut.get("blurScope"),ut.get("disabled"))}),o.eachNode(function(c){var h=c.getLayout(),m=c.getModel(),p=m.get("localX"),y=m.get("localY"),x=m.getModel("emphasis"),V=m.get(["itemStyle","borderRadius"])||0,L=new Kt({shape:{x:p!=null?p*l:h.x,y:y!=null?y*d:h.y,width:h.dx,height:h.dy,r:V},style:m.getModel("itemStyle").getItemStyle(),z2:10});zt(L,Gt(m),{labelFetcher:{getFormattedLabel:function(D,b){return e.getFormattedLabel(D,b,"node")}},labelDataIndex:c.dataIndex,defaultText:c.id}),L.disableLabelAnimation=!0,L.setStyle("fill",c.getVisual("color")),L.setStyle("decal",c.getVisual("style").decal),$t(L,m),s.add(L),g.setItemGraphicEl(c.dataIndex,L),At(L).dataType="node";var S=x.get("focus");Bt(L,S==="adjacency"?c.getAdjacentDataIndices():S==="trajectory"?c.getTrajectoryDataIndices():S,x.get("blurScope"),x.get("disabled"))}),g.eachItemGraphicEl(function(c,h){var m=g.getItemModel(h);m.get("draggable")&&(c.drift=function(p,y){i._focusAdjacencyDisabled=!0,this.shape.x+=p,this.shape.y+=y,this.dirty(),r.dispatchAction({type:"dragNode",seriesId:e.id,dataIndex:g.getRawIndex(h),localX:this.shape.x/l,localY:this.shape.y/d})},c.ondragend=function(){i._focusAdjacencyDisabled=!1},c.draggable=!0,c.cursor="move")}),!this._data&&e.isAnimationEnabled()&&s.setClipPath(ia(s.getBoundingRect(),e,function(){s.removeClipPath()})),this._data=e.getData()},t.prototype.dispose=function(){},t.type="sankey",t}(me);function Ot(a,t,e){switch(a.fill){case"source":a.fill=e.node1.getVisual("color"),a.decal=e.node1.getVisual("style").decal;break;case"target":a.fill=e.node2.getVisual("color"),a.decal=e.node2.getVisual("style").decal;break;case"gradient":var n=e.node1.getVisual("color"),r=e.node2.getVisual("color");mt(n)&&mt(r)&&(a.fill=new Ve(0,0,+(t==="horizontal"),+(t==="vertical"),[{color:n,offset:0},{color:r,offset:1}]))}}function ia(a,t,e){var n=new Kt({shape:{x:a.x-10,y:a.y-10,width:0,height:a.height+20}});return we(n,{shape:{width:a.width+20}},t,e),n}var oa=function(a){Vt(t,a);function t(){var e=a!==null&&a.apply(this,arguments)||this;return e.type=t.type,e}return t.prototype.getInitialData=function(e,n){var r=e.edges||e.links||[],i=e.data||e.nodes||[],o=e.levels||[];this.levelModels=[];for(var s=this.levelModels,u=0;u<o.length;u++)o[u].depth!=null&&o[u].depth>=0&&(s[o[u].depth]=new Se(o[u],this,n));var l=ea(i,r,this,!0,d);return l.data;function d(g,f){g.wrapMethod("getItemModel",function(v,c){var h=v.parentModel,m=h.getData().getItemLayout(c);if(m){var p=m.depth,y=h.levelModels[p];y&&(v.parentModel=y)}return v}),f.wrapMethod("getItemModel",function(v,c){var h=v.parentModel,m=h.getGraph().getEdgeByIndex(c),p=m.node1.getLayout();if(p){var y=p.depth,x=h.levelModels[y];x&&(v.parentModel=x)}return v})}},t.prototype.setNodePosition=function(e,n){var r=this.option.data||this.option.nodes,i=r[e];i.localX=n[0],i.localY=n[1]},t.prototype.getGraph=function(){return this.getData().graph},t.prototype.getEdgeData=function(){return this.getGraph().edgeData},t.prototype.formatTooltip=function(e,n,r){function i(v){return isNaN(v)||v==null}if(r==="edge"){var o=this.getDataParams(e,r),s=o.data,u=o.value,l=s.source+" -- "+s.target;return Pt("nameValue",{name:l,value:u,noValue:i(u)})}else{var d=this.getGraph().getNodeByIndex(e),g=d.getLayout().value,f=this.getDataParams(e,r).data.name;return Pt("nameValue",{name:f!=null?f+"":null,value:g,noValue:i(g)})}},t.prototype.optionUpdated=function(){},t.prototype.getDataParams=function(e,n){var r=a.prototype.getDataParams.call(this,e,n);if(r.value==null&&n==="node"){var i=this.getGraph().getNodeByIndex(e),o=i.getLayout().value;r.value=o}return r},t.type="series.sankey",t.defaultOption={z:2,coordinateSystem:"view",left:"5%",top:"5%",right:"20%",bottom:"5%",orient:"horizontal",nodeWidth:20,nodeGap:8,draggable:!0,layoutIterations:32,label:{show:!0,position:"right",fontSize:12},edgeLabel:{show:!1,fontSize:12},levels:[],nodeAlign:"justify",lineStyle:{color:"#314656",opacity:.2,curveness:.5},emphasis:{label:{show:!0},lineStyle:{opacity:.5}},select:{itemStyle:{borderColor:"#212121"}},animationEasing:"linear",animationDuration:1e3},t}(De);function sa(a,t){a.eachSeriesByType("sankey",function(e){var n=e.get("nodeWidth"),r=e.get("nodeGap"),i=ua(e,t);e.layoutInfo=i;var o=i.width,s=i.height,u=e.getGraph(),l=u.nodes,d=u.edges;da(l);var g=be(l,function(h){return h.getLayout().value===0}),f=g.length!==0?0:e.get("layoutIterations"),v=e.get("orient"),c=e.get("nodeAlign");la(l,d,n,r,o,s,f,v,c)})}function ua(a,t){return Me(a.getBoxLayoutParams(),{width:t.getWidth(),height:t.getHeight()})}function la(a,t,e,n,r,i,o,s,u){ca(a,t,e,r,i,s,u),va(a,t,i,r,n,o,s),Sa(a,s)}function da(a){I(a,function(t){var e=M(t.outEdges,at),n=M(t.inEdges,at),r=t.getValue()||0,i=Math.max(e,n,r);t.setLayout({value:i},!0)})}function ca(a,t,e,n,r,i,o){for(var s=[],u=[],l=[],d=[],g=0,f=0;f<t.length;f++)s[f]=1;for(var f=0;f<a.length;f++)u[f]=a[f].inEdges.length,u[f]===0&&l.push(a[f]);for(var v=-1;l.length;){for(var c=0;c<l.length;c++){var h=l[c],m=h.hostGraph.data.getRawDataItem(h.dataIndex),p=m.depth!=null&&m.depth>=0;p&&m.depth>v&&(v=m.depth),h.setLayout({depth:p?m.depth:g},!0),i==="vertical"?h.setLayout({dy:e},!0):h.setLayout({dx:e},!0);for(var y=0;y<h.outEdges.length;y++){var x=h.outEdges[y],V=t.indexOf(x);s[V]=0;var L=x.node2,S=a.indexOf(L);--u[S]===0&&d.indexOf(L)<0&&d.push(L)}}++g,l=d,d=[]}for(var f=0;f<s.length;f++)if(s[f]===1)throw new Error("Sankey is a DAG, the original data has cycle!");var D=v>g-1?v:g-1;o&&o!=="left"&&ha(a,o,i,D);var b=i==="vertical"?(r-e)/D:(n-e)/D;fa(a,b,i)}function ee(a){var t=a.hostGraph.data.getRawDataItem(a.dataIndex);return t.depth!=null&&t.depth>=0}function ha(a,t,e,n){if(t==="right"){for(var r=[],i=a,o=0;i.length;){for(var s=0;s<i.length;s++){var u=i[s];u.setLayout({skNodeHeight:o},!0);for(var l=0;l<u.inEdges.length;l++){var d=u.inEdges[l];r.indexOf(d.node1)<0&&r.push(d.node1)}}i=r,r=[],++o}I(a,function(g){ee(g)||g.setLayout({depth:Math.max(0,n-g.getLayout().skNodeHeight)},!0)})}else t==="justify"&&ga(a,n)}function ga(a,t){I(a,function(e){!ee(e)&&!e.outEdges.length&&e.setLayout({depth:t},!0)})}function fa(a,t,e){I(a,function(n){var r=n.getLayout().depth*t;e==="vertical"?n.setLayout({y:r},!0):n.setLayout({x:r},!0)})}function va(a,t,e,n,r,i,o){var s=pa(a,o);ya(s,t,e,n,r,o),pt(s,r,e,n,o);for(var u=1;i>0;i--)u*=.99,ma(s,u,o),pt(s,r,e,n,o),wa(s,u,o),pt(s,r,e,n,o)}function pa(a,t){var e=[],n=t==="vertical"?"y":"x",r=Ee(a,function(i){return i.getLayout()[n]});return r.keys.sort(function(i,o){return i-o}),I(r.keys,function(i){e.push(r.buckets.get(i))}),e}function ya(a,t,e,n,r,i){var o=1/0;I(a,function(s){var u=s.length,l=0;I(s,function(g){l+=g.getLayout().value});var d=i==="vertical"?(n-(u-1)*r)/l:(e-(u-1)*r)/l;d<o&&(o=d)}),I(a,function(s){I(s,function(u,l){var d=u.getLayout().value*o;i==="vertical"?(u.setLayout({x:l},!0),u.setLayout({dx:d},!0)):(u.setLayout({y:l},!0),u.setLayout({dy:d},!0))})}),I(t,function(s){var u=+s.getValue()*o;s.setLayout({dy:u},!0)})}function pt(a,t,e,n,r){var i=r==="vertical"?"x":"y";I(a,function(o){o.sort(function(h,m){return h.getLayout()[i]-m.getLayout()[i]});for(var s,u,l,d=0,g=o.length,f=r==="vertical"?"dx":"dy",v=0;v<g;v++)u=o[v],l=d-u.getLayout()[i],l>0&&(s=u.getLayout()[i]+l,r==="vertical"?u.setLayout({x:s},!0):u.setLayout({y:s},!0)),d=u.getLayout()[i]+u.getLayout()[f]+t;var c=r==="vertical"?n:e;if(l=d-t-c,l>0){s=u.getLayout()[i]-l,r==="vertical"?u.setLayout({x:s},!0):u.setLayout({y:s},!0),d=s;for(var v=g-2;v>=0;--v)u=o[v],l=u.getLayout()[i]+u.getLayout()[f]+t-d,l>0&&(s=u.getLayout()[i]-l,r==="vertical"?u.setLayout({x:s},!0):u.setLayout({y:s},!0)),d=u.getLayout()[i]}})}function ma(a,t,e){I(a.slice().reverse(),function(n){I(n,function(r){if(r.outEdges.length){var i=M(r.outEdges,xa,e)/M(r.outEdges,at);if(isNaN(i)){var o=r.outEdges.length;i=o?M(r.outEdges,Ia,e)/o:0}if(e==="vertical"){var s=r.getLayout().x+(i-E(r,e))*t;r.setLayout({x:s},!0)}else{var u=r.getLayout().y+(i-E(r,e))*t;r.setLayout({y:u},!0)}}})})}function xa(a,t){return E(a.node2,t)*a.getValue()}function Ia(a,t){return E(a.node2,t)}function La(a,t){return E(a.node1,t)*a.getValue()}function Va(a,t){return E(a.node1,t)}function E(a,t){return t==="vertical"?a.getLayout().x+a.getLayout().dx/2:a.getLayout().y+a.getLayout().dy/2}function at(a){return a.getValue()}function M(a,t,e){for(var n=0,r=a.length,i=-1;++i<r;){var o=+t(a[i],e);isNaN(o)||(n+=o)}return n}function wa(a,t,e){I(a,function(n){I(n,function(r){if(r.inEdges.length){var i=M(r.inEdges,La,e)/M(r.inEdges,at);if(isNaN(i)){var o=r.inEdges.length;i=o?M(r.inEdges,Va,e)/o:0}if(e==="vertical"){var s=r.getLayout().x+(i-E(r,e))*t;r.setLayout({x:s},!0)}else{var u=r.getLayout().y+(i-E(r,e))*t;r.setLayout({y:u},!0)}}})})}function Sa(a,t){var e=t==="vertical"?"x":"y";I(a,function(n){n.outEdges.sort(function(r,i){return r.node2.getLayout()[e]-i.node2.getLayout()[e]}),n.inEdges.sort(function(r,i){return r.node1.getLayout()[e]-i.node1.getLayout()[e]})}),I(a,function(n){var r=0,i=0;I(n.outEdges,function(o){o.setLayout({sy:r},!0),r+=o.getLayout().dy}),I(n.inEdges,function(o){o.setLayout({ty:i},!0),i+=o.getLayout().dy})})}function Da(a){a.eachSeriesByType("sankey",function(t){var e=t.getGraph(),n=e.nodes,r=e.edges;if(n.length){var i=1/0,o=-1/0;I(n,function(s){var u=s.getLayout().value;u<i&&(i=u),u>o&&(o=u)}),I(n,function(s){var u=new St({type:"color",mappingMethod:"linear",dataExtent:[i,o],visual:t.get("color")}),l=u.mapValueToVisual(s.getLayout().value),d=s.getModel().get(["itemStyle","color"]);d!=null?(s.setVisual("color",d),s.setVisual("style",{fill:d})):(s.setVisual("color",l),s.setVisual("style",{fill:l}))})}r.length&&I(r,function(s){var u=s.getModel().get("lineStyle");s.setVisual("style",u)})})}function ba(a){a.registerChartView(ra),a.registerSeriesModel(oa),a.registerLayout(sa),a.registerVisual(Da),a.registerAction({type:"dragNode",event:"dragnode",update:"update"},function(t,e){e.eachComponent({mainType:"series",subType:"sankey",query:t},function(n){n.setNodePosition(t.dataIndex,[t.localX,t.localY])})})}const Ma=["onClick"],Ea=Wt({__name:"SankeyChart",props:{class:{},data:{}},setup(a){ke([ba,_e]);const t=a,{t:e}=Ut(),n=ze(),r=C(()=>t.class),i=C(()=>({animation:!1,silent:!0,series:{type:"sankey",label:{formatter:"{b}",textBorderWidth:0,fontWeight:"var(--font-weight-l)",fontFamily:"var(--font-family)",color:"var(--chart-label)"},lineStyle:{color:"source",curveness:.5},nodeGap:10,nodeWidth:7,layoutIterations:0,left:0,right:0,links:t.data.links.map(u=>({...u,animation:!0,lineStyle:{opacity:u.muted?.05:.25}})),data:t.data.labels.map(u=>({name:u.name,id:u.id,itemStyle:{color:u.color,opacity:u.muted?.25:1},label:u.align==="left"?{align:"right",opacity:u.muted?.65:1,padding:[0,20,0,0]}:{opacity:u.muted?.65:1}}))}})),o=async()=>{Et(await n.value.toPNG(),"sankey-chart.png")},s=()=>{Et(n.value.toSVG(),"sankey-chart.svg")};return(u,l)=>(tt(),$e("div",{class:O(u.$style.container)},[q(Ce,{ref_key:"chart",ref:n,class:O([u.$style.sankeyChart,r.value]),options:i.value},null,8,["class","options"]),n.value?(tt(),xt(ie,{key:0,position:"top-end",class:O(u.$style.downloadMenu)},{default:Rt(({toggle:d})=>[Pe("button",{type:"button",class:O(u.$style.downloadBtn),onClick:d},[q(P(Ge),{size:"18"})],10,Ma)]),options:Rt(()=>[q(Mt,{icon:P(Te),text:P(e)("page.dashboard.downloadAsPNG"),onClick:o},null,8,["icon","text"]),q(Mt,{icon:P(Ae),text:P(e)("page.dashboard.downloadAsSVG"),onClick:s},null,8,["icon","text"])]),_:1},8,["class"])):Be("",!0)],2))}}),ka="ra",_a="sa",Ca="ta",Ta="ua",Aa={container:ka,sankeyChart:_a,downloadMenu:Ca,downloadBtn:Ta},Ga={$style:Aa},za=qt(Ea,[["__cssModules",Ga]]),$a=Wt({__name:"DistributionChart",props:{class:{},highlight:{}},setup(a){const t=a,e=C(()=>t.class),{state:n}=Re(),{state:r}=Fe(),{n:i,t:o}=Ut(),s=C(()=>n.general.carryOver?Ft(r.income)+(r.overallBalance??0):Ft(r.income)),u=C(()=>R(He(r.expenses))),l=C(()=>!s.value||!u.value),d=C(()=>{const g=p=>i(p,"currency"),f=r.overallBalance??0,v=[],c=[],h=p=>`hsl(${p}, var(--chart-generic-saturation), var(--chart-generic-lightness))`,m={id:F(),name:`Income (${g(s.value)})`,color:h(120)};if(v.push(m),n.general.carryOver&&f>0){const p=F(),y=F();v.push({id:p,name:`${o("page.dashboard.lastYear")} (${g(f)})`,color:h(60+60*(f/s.value)),muted:t.highlight==="expenses"}),v.push({id:y,name:`${o("page.dashboard.surplus")} (${g(f)})`,color:h(60+60*(f/s.value)),muted:t.highlight==="expenses"}),c.push({target:y,source:p,value:f,muted:t.highlight==="expenses"}),c.push({target:m.id,source:y,value:f,muted:t.highlight==="expenses"})}for(const p of r.income){const y=R(p.budgets.flatMap(x=>x.values));if(y){v.push({id:p.id,name:`${p.name} (${g(y)})`,color:h(60+60*(y/s.value)),muted:t.highlight==="expenses"}),c.push({target:m.id,source:p.id,value:y,muted:t.highlight==="expenses"});for(let x=0;x<p.budgets.length;x++){const V=p.budgets[x],L=R(V.values);L&&(v.push({id:V.id,name:`${V.name} (${g(L)})`,color:h(60+60*(L/s.value)),muted:t.highlight==="expenses"}),c.push({target:p.id,source:V.id,value:L,muted:t.highlight==="expenses"}))}}}for(const p of r.expenses){const y=R(p.budgets.flatMap(x=>x.values));if(y){v.push({id:p.id,name:`${p.name} (${g(y)})`,color:h(60*(1-y/u.value)),muted:t.highlight==="income"}),c.push({target:p.id,source:m.id,value:y,muted:t.highlight==="income"});for(let x=0;x<p.budgets.length;x++){const V=p.budgets[x],L=R(V.values);L&&(v.push({id:V.id,name:`${V.name} (${g(L)})`,color:h(60*(1-L/u.value)),align:"left",muted:t.highlight==="income"}),c.push({target:V.id,source:p.id,value:L,muted:t.highlight==="income"}))}}}if(n.general.carryOver&&f<0){const p=F(),y=F();v.push({id:p,name:`${o("page.dashboard.lastYear")} (${g(f)})`,color:h(60+60*(-f/s.value)),muted:t.highlight==="income"}),v.push({id:y,name:`${o("page.dashboard.deficit")} (${g(f)})`,color:h(60+60*(-f/s.value)),muted:t.highlight==="income",align:"left"}),c.push({target:p,source:m.id,value:-f,muted:t.highlight==="income"}),c.push({target:y,source:p,value:-f,muted:t.highlight==="income"})}return{labels:v,links:c}});return(g,f)=>l.value?(tt(),xt(Oe,{key:0})):(tt(),xt(za,{key:1,class:O([g.$style.distributionChart,e.value]),data:d.value},null,8,["class","data"]))}}),Ba="Q_",Pa={distributionChart:Ba},Ra={$style:Pa},Ka=qt($a,[["__cssModules",Ra]]);export{Ka as default};
