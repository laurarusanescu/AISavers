import{G as ie,P as te,v as ce,B as X,D as Z,S as se,b as pe}from"./Button-BP00bKSb.js";import{d as R,C as h,O as H,f as b,o as m,F as N,g as p,m as le,z as ne,n as u,l as E,t as K,P as me,_ as L,Q as oe,R as ae,i as q,e as J,c as D,S as ue,T as re,U as ge,h as I,b as c,V as ve,k as ye,s as _,M as x,x as O,A as fe,a as j,j as $e,G as be}from"./index-h_7xmTiz.js";import{ao as z,S as Ce,an as ke,am as Be,ak as Ie,al as Me,ap as Ge}from"./YearToggle-Boe53fpQ.js";const Ve=["onClick"],De=R({__name:"CellMenu",props:{actions:{}},emits:["action"],setup(G,{emit:g}){const V=g,s=h(),v=h(),r=h(!1),$=h(0);let A,F=-1;H([r,s,v],()=>{r.value&&s.value&&v.value&&(A?.destroy(),A=me(s.value,v.value,{strategy:"absolute",placement:"top-start",modifiers:[{name:"offset",options:{offset:[0,5]}}]}))}),H($,d=>{cancelAnimationFrame(F),F=requestAnimationFrame(()=>r.value=d>0)});const M=d=>{V("action",d),cancelAnimationFrame(F),r.value=!1};return(d,B)=>(m(),b(N,null,[p("div",{ref_key:"reference",ref:s,class:u(d.$style.reference),onFocusout:B[0]||(B[0]=i=>$.value--),onFocusin:B[1]||(B[1]=i=>$.value++)},[ne(d.$slots,"default")],34),r.value?(m(),b("div",{key:0,ref_key:"popper",ref:v,class:u(d.$style.popper),onFocusout:B[2]||(B[2]=i=>$.value--),onFocusin:B[3]||(B[3]=i=>$.value++)},[p("ul",{class:u(d.$style.list)},[(m(!0),b(N,null,E(d.actions,i=>(m(),b("li",{key:i.id,class:u(d.$style.item)},[p("button",{class:u(d.$style.btn),tabindex:"0",type:"button",onClick:y=>M(i.id)},K(i.label),11,Ve)],2))),128))],2)],34)):le("",!0)],64))}}),we="sc",Ae="tc",Fe="uc",he="vc",Ne="wc",Se={reference:we,popper:Ae,list:Fe,item:he,btn:Ne},Te={$style:Se},Re=L(De,[["__cssModules",Te]]),Pe=["type","value","data-testid"],Ue=R({__name:"CurrencyCell",props:oe({max:{default:Number.MAX_SAFE_INTEGER},testId:{}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(G){const g=ae(G,"modelValue"),V=G,s=h(),v=h(!1),{state:r}=q(),{n:$}=J(),A=D(()=>v.value||!g.value?g.value||"":$(g.value,{key:"currency",currency:r.currency})),F=i=>{const y=Number(i?.trim()||NaN);g.value=Number.isNaN(y)?0:y},M=i=>{i.key==="-"&&i.preventDefault()},d=()=>{v.value=!0,re(()=>s.value.select())},B=i=>F(i.target.value);return H(()=>g.value,(i,y)=>{(i??0)>V.max&&y!==void 0&&(g.value=y)}),(i,y)=>(m(),b("input",{ref_key:"input",ref:s,class:u(i.$style.currencyCell),type:v.value?"number":"text",value:A.value,"data-testid":i.testId,onBlur:y[0]||(y[0]=S=>v.value=!1),onFocus:d,onInput:B,onKeydown:[M,y[1]||(y[1]=ue(S=>s.value?.blur(),["enter"]))]},null,42,Pe))}}),Ee="Tc",Le={currencyCell:Ee},Ye={$style:Le},ze=L(Ue,[["__cssModules",Ye]]),l=ge({group:void 0,source:void 0,target:void 0,targets:void 0,type:void 0}),Ke=R({__name:"Draggable",props:{text:{type:Function},icon:{type:Function},target:{},name:{},id:{}},emits:["drop"],setup(G,{emit:g}){const V=g,s=G,v=h(),r=h(),$=h(0),A=h(0),F=D(()=>s.id===l.target&&l.type),M=D(()=>s.target??[s.name]),d=D(()=>l.targets?.includes(s.name)),B=D(()=>F.value?s.icon?.(l)??(l.type==="before"?ie:te):ce),i=D(()=>l.target&&l.target&&l.source?s.text?.(l):void 0),y=t=>{t.dataTransfer&&r.value&&(l.group=s.name,l.source=s.id,l.targets=M.value,t.dataTransfer.effectAllowed="move",t.dataTransfer.setDragImage(r.value,1/0,1/0),t.dataTransfer.setData("text/plain",s.name))},S=t=>{$.value=t.pageX,A.value=t.pageY},P=t=>{if(l.group&&l.targets?.includes(l.group)){const Y=v.value?.getBoundingClientRect();if(t.preventDefault(),Y&&s.id!==l.source){const e=t.pageY<Y.top+Y.height/2?"before":"after";l.target=s.id,l.type=e}}},a=t=>{t.pageX&&t.pageY&&l.target!==s.id&&(l.type=void 0,l.target=void 0)},n=()=>{l.type=void 0,l.target=void 0,l.targets=void 0,l.source=void 0,l.group=void 0},C=t=>{l.type&&l.target&&l.source&&l.group&&V("drop",{group:l.group,source:l.source,target:l.target,type:l.type}),t.preventDefault()};return(t,Y)=>(m(),b("div",{ref_key:"draggable",ref:v,class:u(t.$style.draggable),draggable:"true",onDragend:n,onDragover:P,onDragleave:a,onDrop:C,onDrag:S,onDragstart:y},[I(X,{color:d.value&&c(l).source!==t.id?"primary":"dimmed",icon:B.value,textual:""},null,8,["color","icon"]),c(l).source===s.id&&A.value&&$.value&&i.value?(m(),b("div",{key:0,style:ve({top:`${A.value+5}px`,left:`${$.value+5}px`}),class:u(t.$style.content)},[p("span",{class:u(t.$style.text)},K(i.value),3)],6)):le("",!0),p("div",{ref_key:"element",ref:r,class:u(t.$style.hidden)},"hidden",2)],34))}}),Xe="X_",Oe="Y_",je="Z_",qe="_a",He={draggable:Xe,content:Oe,text:je,hidden:qe},Je={$style:He},de=L(Ke,[["__cssModules",Je]]),Qe=["value"],We=R({__name:"TextCell",props:oe({inline:{type:Boolean,default:!1}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(G){const g=ae(G,"modelValue"),V=G,s=h(),v=ye(),r=h(!1),$=D(()=>[v.textInput,{[v.empty]:!g.value,[v.inline]:V.inline}]),A=()=>{r.value=!0,re(()=>s.value.select())},F=M=>{g.value=M.target.value};return(M,d)=>(m(),b("span",{class:u($.value)},[p("input",{ref_key:"input",ref:s,value:g.value,class:u(M.$style.input),type:"text",onBlur:d[0]||(d[0]=B=>r.value=!1),onFocus:A,onInput:F,onKeydown:d[1]||(d[1]=ue((...B)=>s.value?.blur&&s.value?.blur(...B),["enter"]))},null,42,Qe)],2))}}),Ze="Uc",_e="Vc",xe="Wc",et={textInput:Ze,input:_e,inline:xe},tt={$style:et},ee=L(We,[["__cssModules",tt]]),st=["onFocusin"],lt=R({__name:"BudgetGroup",props:{group:{},testId:{}},setup(G){const g=G,{moveBudget:V,removeBudgetGroup:s,getBudget:v,getBudgetGroup:r,addBudget:$,setBudgetName:A,setBudgetGroupName:F,setBudget:M,fillBudget:d,removeBudget:B,isCurrentMonth:i}=q(),{t:y}=J(),S=h(),P=D(()=>{const e=new Array(12).fill(0);for(const{values:f}of g.group.budgets)for(let o=0;o<f.length;o++)e[o]+=f[o];return e}),a=D(()=>_(P.value)),n=D(()=>x(P.value)),C=e=>{const[f,o]=e.source?v(e.source)??[]:[],[k,U]=e.target?v(e.target)??[]:[],w=e.target?r(e.target):void 0;if(o&&f){if(U&&k){const T=f.id===k.id,Q=T?o.name:`${f.name} » ${o.name}`,W=T?U.name:`${k.name} » ${U.name}`;return e.type==="before"?y("shared.prepend",{from:Q,to:W}):y("shared.append",{from:Q,to:W})}return w?y("shared.moveInto",{from:o.name,to:w.name}):y("shared.move",{from:o.name})}},t=e=>{V(e.source,e.target,e.type==="after")},Y=(e,f,o,k)=>{switch(e){case"fill":return d(f,k);case"fill-to-right":return d(f,k,o)}};return(e,f)=>(m(),b(N,null,[I(X,{color:"dimmed",icon:c(Z),textual:"",onClick:f[0]||(f[0]=o=>c(s)(e.group.id))},null,8,["icon"]),I(ee,{class:u([e.$style.top,e.$style.start]),modelValue:e.group.name,inline:"","onUpdate:modelValue":f[1]||(f[1]=o=>c(F)(e.group.id,o))},null,8,["class","modelValue"]),(m(!0),b(N,null,E(P.value,(o,k)=>(m(),b("span",{key:k,class:u(e.$style.top)},[I(z,{value:o,testId:`${e.testId}-month-${k}-total`},null,8,["value","testId"])],2))),128)),p("span",{class:u(e.$style.top)},[p("span",null,K(c(y)("shared.total")),1)],2),p("span",{class:u([e.$style.top,e.$style.end])},[p("span",null,K(c(y)("shared.average")),1)],2),(m(!0),b(N,null,E(e.group.budgets,(o,k)=>(m(),b(N,{key:o.id+k},[I(de,{id:o.id,target:["budget-group","budget-groups"],name:"budget-group",text:C,onDrop:t},null,8,["id"]),I(X,{color:"dimmed",icon:c(Z),textual:"",onClick:U=>c(B)(o.id)},null,8,["icon","onClick"]),p("span",{class:u(e.$style.header)},[I(ee,{modelValue:o.name,"onUpdate:modelValue":U=>c(A)(o.id,U)},null,8,["modelValue","onUpdate:modelValue"])],2),(m(!0),b(N,null,E(o.values,(U,w)=>(m(),b("span",{key:o.id+w,class:u([e.$style.currencyCell,{[e.$style.even]:k%2,[e.$style.firstRow]:k===0,[e.$style.firstColumn]:w===0,[e.$style.currentMonth]:c(i)(w),[e.$style.tlc]:k===0&&w===0,[e.$style.trc]:k===0&&w===11,[e.$style.blc]:k===e.group.budgets.length-1&&w===0,[e.$style.brc]:k===e.group.budgets.length-1&&w===11}]),onFocusin:T=>S.value=o.id,onFocusout:f[2]||(f[2]=T=>S.value=void 0)},[I(Re,{actions:[{id:"fill",label:c(y)("shared.fillRow")},{id:"fill-to-right",label:c(y)("shared.fillRowToRight")}],onAction:T=>Y(T,o.id,w,o.values[w])},{default:O(()=>[I(ze,{testId:`${e.testId}-budget-${k}-${w}`,modelValue:o.values[w],"onUpdate:modelValue":T=>c(M)(o.id,w,T)},null,8,["testId","modelValue","onUpdate:modelValue"])]),_:2},1032,["actions","onAction"])],42,st))),128)),I(z,{testId:`${e.testId}-budget-${k}-total`,class:u(e.$style.meta),value:c(_)(o.values)},null,8,["testId","class","value"]),I(z,{testId:`${e.testId}-budget-${k}-average`,class:u(e.$style.meta),value:c(x)(o.values)},null,8,["testId","class","value"])],64))),128)),f[4]||(f[4]=p("span",null,null,-1)),I(X,{icon:c(se),textual:"",onClick:f[3]||(f[3]=o=>c($)(e.group.id))},null,8,["icon"]),f[5]||(f[5]=p("span",{style:{"grid-column":"3 / 16"}},null,-1)),I(z,{class:u([e.$style.meta,e.$style.bold]),value:a.value},null,8,["class","value"]),I(z,{class:u([e.$style.meta,e.$style.bold]),value:n.value},null,8,["class","value"])],64))}}),nt="-a",ot="aa",at="ba",ut="ca",rt="da",dt="ea",it="fa",ct="ga",pt="ha",mt="ia",gt="ja",vt="ka",yt="la",ft="ma",$t="na",bt={header:nt,meta:ot,bold:at,top:ut,start:rt,end:dt,currencyCell:it,firstRow:ct,firstColumn:pt,currentMonth:mt,even:gt,tlc:vt,trc:yt,blc:ft,brc:$t},Ct={$style:bt},kt=L(lt,[["__cssModules",Ct]]),Bt=["data-testid"],It=R({__name:"BudgetGroups",props:{type:{}},setup(G){const g=G,{state:V,moveBudgetGroup:s,moveBudgetIntoGroup:v,addBudgetGroup:r,getBudgetGroup:$,isCurrentMonth:A}=q(),{state:F}=fe(),{t:M}=J(),d=D(()=>V[g.type]),B=pe("long",()=>F.general.monthOffset),i=D(()=>{const a=new Array(12).fill(0);for(const{budgets:n}of d.value)for(const{values:C}of n)for(let t=0;t<C.length;t++)a[t]+=C[t];return a}),y=a=>a.group==="budget-group"?te:void 0,S=a=>{const n=a.source?$(a.source):void 0,C=a.target?$(a.target):void 0;if(n)return C?a.type==="before"?M("shared.prepend",{from:n.name,to:C.name}):M("shared.append",{from:n.name,to:C.name}):M("shared.move",{from:n.name})},P=a=>{a.group==="budget-group"?v(a.source,a.target):s(a.source,a.target,a.type==="after")};return(a,n)=>(m(),b("div",{class:u(a.$style.budgetGroups)},[n[1]||(n[1]=p("span",null,null,-1)),n[2]||(n[2]=p("span",null,null,-1)),n[3]||(n[3]=p("span",null,null,-1)),(m(!0),b(N,null,E(c(B),(C,t)=>(m(),b("span",{key:C,"data-testid":`month-${t}-name`,class:u([a.$style.month,{[a.$style.current]:c(A)(t),[a.$style.start]:t===0,[a.$style.end]:t===11}])},[p("span",null,K(C),1)],10,Bt))),128)),n[4]||(n[4]=p("span",null,null,-1)),n[5]||(n[5]=p("span",null,null,-1)),n[6]||(n[6]=p("span",null,null,-1)),n[7]||(n[7]=p("span",null,null,-1)),p("span",{class:u(a.$style.sum)},K(c(M)("shared.totals")),3),(m(!0),b(N,null,E(i.value,(C,t)=>(m(),j(z,{key:t,testId:`month-${t}-total`,value:C,class:u(a.$style.sum)},null,8,["testId","value","class"]))),128)),n[8]||(n[8]=p("span",null,null,-1)),n[9]||(n[9]=p("span",null,null,-1)),(m(!0),b(N,null,E(d.value,(C,t)=>(m(),b(N,{key:C.id},[I(de,{id:C.id,icon:y,text:S,name:"budget-groups",onDrop:P},null,8,["id"]),I(kt,{group:C,testId:`group-${t}`},null,8,["group","testId"])],64))),128)),n[10]||(n[10]=p("span",null,null,-1)),I(X,{class:u(a.$style.addGroupBtn),size:"s",icon:c(se),text:c(M)("shared.addGroup"),onClick:n[0]||(n[0]=C=>c(r)(a.type))},null,8,["class","icon","text"])],2))}}),Mt="H_",Gt="I_",Vt="J_",Dt="K_",wt="L_",At="M_",Ft="N_",ht={budgetGroups:Mt,sum:Gt,month:Vt,current:Dt,start:wt,end:At,addGroupBtn:Ft},Nt={$style:ht},St=L(It,[["__cssModules",Nt]]),Tt=R({__name:"MiniChart",props:{class:{},values:{}},setup(G){Ce([Be,Ie,Me]);const g=G,V=D(()=>g.class),s=D(()=>({xAxis:{type:"category",show:!1},yAxis:{show:!1,min:Math.min(...g.values)},grid:{top:"15%",left:0,bottom:"20%",right:0},series:[{data:g.values,type:"line",smooth:!0,showSymbol:!1,silent:!0}]}));return(v,r)=>(m(),j(ke,{class:u(V.value),options:s.value},null,8,["class","options"]))}}),Rt=R({__name:"BudgetPane",props:{title:{},type:{}},setup(G){const g=G,{state:V}=q(),s=D(()=>$e(V[g.type])),v=D(()=>s.value.reduce((r,$)=>r+$,0));return(r,$)=>(m(),j(Ge,{testId:r.type,amount:v.value,title:r.title},be({header:O(()=>[I(Tt,{class:u(r.$style.miniChart),values:s.value},null,8,["class","values"])]),default:O(()=>[(m(),j(St,{key:c(V).activeYear,type:r.type},null,8,["type"]))]),_:2},[r.$slots.title?{name:"title",fn:O(()=>[ne(r.$slots,"title")]),key:"0"}:void 0]),1032,["testId","amount","title"]))}}),Pt="h",Ut={miniChart:Pt},Et={$style:Ut},Kt=L(Rt,[["__cssModules",Et]]);export{Kt as B};
